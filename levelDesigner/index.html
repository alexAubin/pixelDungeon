<html>
    <head>
        <title>Pixel Dungeon - Level designer</title>
        <link rel="stylesheet" href="./pure-release-0.5.0/pure-min.css">
        <link rel="stylesheet" href="./font-awesome-4.2.0/css/font-awesome.min.css">


    </head>
    <body onload="loadGrid()">
        <br><br> 
        <center>
        <table width="50%"><tr>
        <td width="50%">
                <center>
                <div id="debug">(x,y) = (...,...)</div><br>
                <button class="pure-button"><i class="fa fa-cube"></i>  Drawing : walls</button><br><br>
                <button class="pure-button"><i class="fa fa-wrench"></i>  Edit object</button><br><br>
                <button class="pure-button"><i class="fa fa-eraser"></i>  Erase</button><br><br>
                <button class="pure-button"><i class="fa fa-save"></i>  Export</button>
                </center>
        </td><td>
                <canvas id="grid" width="500px" height="500px" onclick="clickHandler(event)" onmousemove="moveHandler(event)">
                </canvas>
        </td>
        </tr></table>
        </center>    


        <script type="text/javascript">
            
            var map;

            // Define map parameters
            var mapWidth  = 16;
            var mapHeight = 16;

            var tileSize       = 25;
            var tileSpace      = 1;
                
            // Get canvas
            var grid   = document.getElementById("grid");
            var canvas = grid.getContext("2d");

            var previousTileX = -1;
            var previousTileY = -1;


            function loadGrid()
            {
                // Create map
                map = [];
                for(var x=0 ; x < mapWidth ; x++) 
                {
                    map[x] = [];
                    for(var y=0; y < mapHeight ; y++) 
                    {
                        map[x][y] = { x: x, y: y, type: "empty"};
                        drawTile(x, y);
                    }
                }
            }
    
            function getMousePosition(event)
            {
                var mouseX = event.clientX - grid.getBoundingClientRect().left;
                var mouseY = event.clientY - grid.getBoundingClientRect().top;

                var tileX = parseInt(mouseX/(tileSize + 2 * tileSpace));
                var tileY = parseInt(mouseY/(tileSize + 2 * tileSpace));

                if (tileX >= mapWidth ) tileX = -1;
                if (tileY >= mapHeight) tileY = -1;
                
                return [tileX, tileY];
                
            }

            function clickHandler(event)
            {
                [tileX, tileY] = getMousePosition(event);
                map[tileX][tileY].type = "wall";
                drawTile(tileX,tileY);
            }

            function moveHandler(event)
            {
                [tileX, tileY] = getMousePosition(event);

                if ((tileX == previousTileX) && (tileY == previousTileY)) return;

                var tilePositionX = previousTileX * (tileSize + 2 * tileSpace) + tileSpace;
                var tilePositionY = previousTileY * (tileSize + 2 * tileSpace) + tileSpace;

                drawTile(previousTileX, previousTileY);
                
                previousTileX = tileX;
                previousTileY = tileY;

                var tilePositionX = tileX * (tileSize + 2 * tileSpace) + tileSpace;
                var tilePositionY = tileY * (tileSize + 2 * tileSpace) + tileSpace;

                canvas.beginPath();
                canvas.lineWidth = "1";
                canvas.strokeStyle="black";
                canvas.rect(tilePositionX,tilePositionY,tileSize,tileSize);
                canvas.stroke();
                debug.innerHTML = "(x,y) = (" + tileX + "," + tileY + ")";
            }

            function drawTile(x, y)
            {
                if (x == -1) return;
                if (y == -1) return;

                var tilePositionX = x * (tileSize + 2 * tileSpace) + tileSpace;
                var tilePositionY = y * (tileSize + 2 * tileSpace) + tileSpace;
                // Erase old stuff
                canvas.fillStyle = "white";
                canvas.fillRect(tilePositionX-1,tilePositionY-1,tileSize+2,tileSize+2);
                // Print required color
                var type = map[x][y].type;

                     if (type == "empty") canvas.fillStyle = "rgba(200,200,200,0.5)";
                else if (type == "wall")  canvas.fillStyle = "rgba(15,15,15,0.5)";

                canvas.fillRect(tilePositionX,tilePositionY,tileSize,tileSize);
            }

        </script>
    </body>
</html>
